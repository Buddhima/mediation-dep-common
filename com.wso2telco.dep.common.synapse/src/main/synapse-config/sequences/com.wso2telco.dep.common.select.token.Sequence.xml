<?xml version="1.0" encoding="UTF-8"?>
<sequence name="com.wso2telco.dep.common.select.token.Sequence" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
  <!-- remove rest url postfix -->
  <property action="remove" name="REST_URL_POSTFIX" scope="axis2"/>
  <property
    expression="get-property('registry', 'conf:/repository/wso2telco/configurations/mediationConfig.xml')"
    name="mediationConfig" scope="default" type="OM"/>
  <property expression="$ctx:mediationConfig//tokenPoolService/enable"
    name="TOKEN_POOL_SERVICE_ENABLED" scope="default" type="STRING"/>
  <filter regex="true" source="get-property('TOKEN_POOL_SERVICE_ENABLED')">
    <then>
      <property expression="$ctx:mediationConfig//tokenPoolService/url"
        name="TOKEN_POOL_SERVICE_URL" scope="default" type="STRING"/>
      <sequence key="com.wso2telco.dep.common.token.pool.retriever.Sequence"/>
    </then>
    <else>
      <sequence key="com.wso2telco.dep.common.default.token.retriever.Sequence"/>
    </else>
  </filter>
</sequence>
