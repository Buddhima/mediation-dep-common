<?xml version="1.0" encoding="UTF-8"?>
<template name="com.wso2telco.dep.common.msisdnValidator.Template" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="paramName"/>
    <parameter name="paramValue"/>
    <parameter name="paramArray"/>
    <sequence>
        <property
            expression="get-property('registry', 'conf:/repository/wso2telco/configurations/mediationConfig.xml')"
            name="MEDIATION_CONFIG" scope="default" type="OM"/>
        <property expression="$ctx:MEDIATION_CONFIG//msisdn_regex"
            name="MSISDN_REGEX" scope="default" type="STRING"/>

        <property expression="$func:paramValue" name="MSISDN_VALUE"
                  scope="default" type="STRING"/>

        <property expression="$func:paramName"
            name="MSISDN_PARAM_NAME" scope="default" type="STRING"/>

        <property expression="$func:paramArray"
            name="MSISDN_PARAM_ARRAY" scope="default" type="STRING"/>

        <class name="com.wso2telco.dep.common.mediation.MSISDNValidationMediator"/>
        <filter regex="true" source="get-property('INTERNAL_ERROR')">
            <then>
                <sequence key="com.wso2telco.dep.common.response.exceptions.Sequence"/>
            </then>
            <else>
                <filter regex="false" source="get-property('MSISDN_VALID')">
                    <then>
                        <sequence key="com.wso2telco.dep.common.response.exceptions.Sequence"/>
                    </then>
                    <else/>
                </filter>
            </else>
        </filter>
    </sequence>
</template>
